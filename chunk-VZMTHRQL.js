import{a as g}from"./chunk-S4RFOJO2.js";import{C as J,a as Z,h as H,j as W}from"./chunk-RCIVPRKJ.js";import"./chunk-N23KSFRB.js";import{$ as p,$a as c,Cb as V,Ea as y,Gb as B,Hb as D,Ib as $,Jb as j,K as m,Kb as R,L as f,M as v,Ob as U,P as E,Pa as I,S as u,V as w,Wa as r,Xa as C,Ya as S,Z as i,Za as k,_ as a,a as b,ab as N,cb as G,da as x,db as M,ib as O,ka as T,lb as _,qb as z,rb as A,sb as F,tb as L,ub as q,vb as P}from"./chunk-44MH6WD3.js";import"./chunk-ZTRS6MQZ.js";import"./chunk-7AA6B6AB.js";import"./chunk-WAVX4AJH.js";import"./chunk-G67DLYCP.js";import"./chunk-G3CV3VGG.js";import"./chunk-IEY6ZC2G.js";import"./chunk-MNDBORQJ.js";import"./chunk-7QVI4S4L.js";import"./chunk-4U6PRYVA.js";import"./chunk-6BZ4INXC.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-LNJ3S2LQ.js";function K(l,s){l&1&&(i(0,"ion-button",9),p(1,"ion-spinner"),a())}function Q(l,s){l&1&&(i(0,"ion-button",10)(1,"ion-text"),T(2,"Modifye"),a()())}var le=(()=>{let s=class s{constructor(e,o){this.compteService=e,this.router=o,this.formGroup=new k({nom:new c("",[r.required,r.minLength(3),r.pattern("^[a-zA-Z\\s]+$")]),prenom:new c("",[r.required,r.minLength(3),r.pattern("^[a-zA-Z\\s]+$")]),telephone:new c("",[r.required,r.pattern("^[0-9]{8}$")]),username:new c("",[r.required,r.minLength(4),r.pattern("^[a-zA-Z0-9\\s]+$")])}),this.isLoading=!1,this.toastColor="",this.isToastOpen=!1,this.toastMessage="",this.toastIcon="",this.compte=new g,this.prenomErrorText="Non an paka rete vid",this.nomErrorText="Sinyati an paka rete vid",this.telephoneErrorText="Nimewo Telefon nan paka rete vid",this.usernameErrorText="Non itilizate a paka rete vid",this.subscription=new b,J({checkmarkSharp:H,closeSharp:W}),this.subscription.add(this.formGroup.valueChanges.subscribe(()=>{this.showErrorsWhenFormIsInvalid(this.formGroup.controls)}))}initCompte(){this.subscription.add(this.compteService.getCompteAuthenticated().subscribe({next:e=>{this.initFormGroup(e),this.compte=e},error:()=>{}}))}initFormGroup(e){this.formGroup.setValue({nom:e.nom,prenom:e.prenom,telephone:e.telephone,username:e.username})}showErrorsWhenFormIsInvalid(e){Object.keys(e).forEach(o=>{e[o].invalid&&(e[o].touched||e[o].dirty)&&(e[o].hasError("required")&&this.requiredErrorText(o),e.prenom.hasError("minlength")&&(this.prenomErrorText="Non an dwe gen pou pi piti 3 karakte"),e.prenom.hasError("pattern")&&(this.prenomErrorText="Non sa pa valid"),e.nom.hasError("minlength")&&(this.nomErrorText="Sinyati an dwe gen pou pi piti 3 karakte"),e.nom.hasError("pattern")&&(this.nomErrorText="Sinyati sa pa valid"),e.username.hasError("minlength")&&(this.usernameErrorText="Non itilizate an dwe gen pou pi piti 4 karakte"),e.username.hasError("pattern")&&(this.usernameErrorText="Non itilizate sa pa valid"),e.telephone.hasError("pattern")&&(this.telephoneErrorText="Nimewo telefon nan sipoze gen 8 chif"))})}requiredErrorText(e){switch(e){case"prenom":this.prenomErrorText="Non an paka rete vid";break;case"nom":this.nomErrorText="Sinyati an paka rete vid";break;case"telephone":this.telephoneErrorText="Nimewo telefon nan paka rete vid";break;case"username":this.usernameErrorText="Non itilizate an paka rete vid";break}}onSubmit(){var e,o,t;if(this.formGroup.markAllAsTouched(),!this.formGroup.invalid){this.isLoading=!0;let n=this.formGroup.value,d=new g;n.nom=(e=n.nom)==null?void 0:e.trim(),n.prenom=(o=n.prenom)==null?void 0:o.trim(),n.username=(t=n.username)==null?void 0:t.trim(),d.nom=n.nom,d.prenom=n.prenom,d.telephone=n.telephone,d.username=n.username,this.compteService.updateInfo(d).subscribe({next:h=>{this.isLoading=!1,this.showToast(h.message.contenu,h.message.type)},error:h=>{this.isLoading=!1;try{this.showToast(h.error.message.contenu,h.error.message.type,()=>{h.error.message.codeError===1&&(this.formGroup.reset(),this.router.navigate(["/login"]))})}catch{this.showToast("Verifye koneksyon entenet ou an","error")}}})}}showToast(e,o,t){o==="success"?(this.toastIcon="checkmark-sharp",this.toastColor="success"):(this.toastIcon="close-sharp",this.toastColor="danger"),this.toastMessage=e,this.isToastOpen=!0,setTimeout(()=>{this.closeToast(),t&&t()},3500)}closeToast(){this.isToastOpen=!1}ngOnInit(){this.initCompte()}ngOnDestroy(){this.subscription.unsubscribe()}};s.\u0275fac=function(o){return new(o||s)(f(Z),f(I))},s.\u0275cmp=v({type:s,selectors:[["app-update-infos"]],decls:27,vars:15,consts:[[1,"ion-page"],["slot","start"],["defaultHref","/accueil"],[3,"submit","formGroup"],["formControlName","prenom","label","Non","label-placement","floating","placeholder","Antre non ou","helperText","Sa ap pemet nou pi byen idantifye w",3,"errorText","value"],["formControlName","nom","label","Sinyati","label-placement","floating","placeholder","Antre sinyatiw ou","helperText","Sa ap pemet nou pi byen idantifye w",3,"errorText","value"],["formControlName","telephone","type","telephone","label","Telefon","label-placement","floating","placeholder","Antre telefon ou","helperText","Nimewo sa ap pemet ou fe tranzaksyon MonCash sou platfom lan",3,"errorText","value"],["formControlName","username","label","Non Itilizate","label-placement","floating","placeholder","Antre on non itilizate","helperText","Non sa ap pemet ou pi diskre sou platfom nan",3,"errorText","value"],[1,"last-ion-row"],["disabled","true","expand","block","type","submit"],["expand","block","type","submit"],["position","top",3,"color","isOpen","message","duration","icon"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",1),p(4,"ion-back-button",2),a(),i(5,"ion-title"),T(6,"Modifye Enfomasyon Pesonel"),a()()(),i(7,"ion-content")(8,"form",3),x("submit",function(){return t.onSubmit()}),i(9,"ion-grid")(10,"ion-row")(11,"ion-col"),p(12,"ion-input",4),a()(),i(13,"ion-row")(14,"ion-col"),p(15,"ion-input",5),a()(),i(16,"ion-row")(17,"ion-col"),p(18,"ion-input",6),a()(),i(19,"ion-row")(20,"ion-col"),p(21,"ion-input",7),a()(),i(22,"ion-row",8)(23,"ion-col"),E(24,K,2,0,"ion-button",9)(25,Q,3,0,"ion-button",10),a()()()(),p(26,"ion-toast",11),a()()),o&2&&(m(8),u("formGroup",t.formGroup),m(4),u("errorText",t.prenomErrorText)("value",t.compte.prenom),m(3),u("errorText",t.nomErrorText)("value",t.compte.nom),m(3),u("errorText",t.telephoneErrorText)("value",t.compte.telephone),m(3),u("errorText",t.usernameErrorText)("value",t.compte.username),m(3),w(t.isLoading?24:25),m(2),u("color",t.toastColor)("isOpen",t.isToastOpen)("message",t.toastMessage)("duration",3e3)("icon",t.toastIcon))},dependencies:[j,D,B,z,O,N,C,S,G,M,U,F,V,q,_,A,L,P,$,R,y],styles:["form[_ngcontent-%COMP%]{height:100%}ion-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.last-ion-row[_ngcontent-%COMP%]{margin-top:auto}"]});let l=s;return l})();export{le as UpdateInfosPage};
