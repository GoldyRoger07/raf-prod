import{a as he}from"./chunk-2QZJ7VVD.js";import{a as de}from"./chunk-IB4EGLVS.js";import{C as ue,a as me,h as ce,j as pe}from"./chunk-RCIVPRKJ.js";import"./chunk-N23KSFRB.js";import{$ as m,$a as C,Aa as V,Cb as ie,D as k,Da as N,E as I,Ea as B,Gb as ne,Hb as oe,Ib as re,Jb as ae,K as s,Kb as se,L as S,M as w,Ob as le,P as h,S as p,V as A,W as O,Wa as T,X as G,Xa as L,Y as E,Ya as z,Z as n,Za as j,_ as o,ab as q,ca as P,cb as K,da as f,db as $,ea as g,eb as D,g as b,hb as U,ib as H,ka as l,la as v,lb as Z,ma as M,o as _,oa as R,qb as W,ra as u,rb as J,s as x,sa as d,sb as Q,t as y,tb as X,ub as Y,vb as ee,ya as F,zb as te}from"./chunk-44MH6WD3.js";import"./chunk-ZTRS6MQZ.js";import"./chunk-7AA6B6AB.js";import"./chunk-WAVX4AJH.js";import"./chunk-G67DLYCP.js";import"./chunk-G3CV3VGG.js";import"./chunk-IEY6ZC2G.js";import"./chunk-MNDBORQJ.js";import"./chunk-7QVI4S4L.js";import"./chunk-4U6PRYVA.js";import"./chunk-6BZ4INXC.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-LNJ3S2LQ.js";function fe(r,a){if(r&1){let c=P();n(0,"div",16),f("click",function(){let t=k(c).$implicit,e=g(2);return I(e.onClickRow(t))}),l(1),o()}if(r&2){let c=a.$implicit;s(),M(" ",c," ")}}function ge(r,a){if(r&1&&(n(0,"div",13)(1,"div",14)(2,"ion-list"),G(3,fe,2,1,"div",15,O),u(5,"async"),o()()()),r&2){let c=g();s(3),E(d(5,0,c.usernames$))}}function ve(r,a){r&1&&(n(0,"ion-button",10),m(1,"ion-spinner"),o())}function Te(r,a){r&1&&(n(0,"ion-button",11)(1,"ion-text"),l(2,"Valide"),o()())}var Pe=(()=>{let a=class a{constructor(i){this.compteService=i,this.formGroup=new j({username:new C("",[T.required]),montant:new C("",[T.required,he])}),this.montantErrorText="Kantite lajan an paka rete vid",this.isFocus=!1,this.isLoading=!1,this.isAlertOpen=!1,this.isToastOpen=!1,this.colorToast="",this.iconToast="",this.message="",this.toastMessage="",this.usernames$=this.getUsernames(),this.commissionRetrait=1,this.montantCalculer=0,this.commissionAgent=0,this.alertButtons=[{text:"Ok",role:"cancel",handler:()=>{this.setOpen(!1)}}],ue({closeSharp:pe,checkmarkSharp:ce}),this.formGroup.controls.username.valueChanges.subscribe(()=>{this.isFocus||(this.isFocus=!0)}),this.formGroup.controls.montant.valueChanges.subscribe(t=>{let e=parseInt(t);e>=0?(this.montantCalculer=e*this.commissionRetrait,this.commissionAgent=this.montantCalculer-e):(this.montantCalculer=0,this.commissionAgent=0),this.formGroup.controls.montant.hasError("greaterThanZero")&&(this.montantErrorText="Chif sa pa valid")})}ngOnInit(){this.compteService.getAgentCommissionRetrait().subscribe({next:i=>{this.commissionRetrait=i}})}onSubmit(){if(this.formGroup.markAllAsTouched(),!this.formGroup.invalid){this.isLoading=!0;let i=this.formGroup.value;this.compteService.retraitAgent(i).subscribe({next:t=>{this.isLoading=!1,this.formGroup.reset(),this.showToast(t.message.contenu,t.message.type)},error:t=>{this.isLoading=!1;try{this.showToast(t.error.message.contenu,t.error.message.type)}catch{this.showToast("Verifye koneksyon entenet ou an","error")}}})}}getUsernames(){let i=this.formGroup.controls.username.valueChanges.pipe(x(""),_(150));return b([i]).pipe(y(([t])=>this.compteService.getAllUsernames(t)))}onClickRow(i){this.formGroup.setValue({username:i,montant:this.formGroup.value.montant}),this.isFocus=!1}setOpen(i){this.isAlertOpen=i}showToast(i,t,e){t==="success"?(this.iconToast="checkmark-sharp",this.colorToast="success"):(this.iconToast="close-sharp",this.colorToast="danger"),this.toastMessage=i,this.isToastOpen=!0,setTimeout(()=>{this.closeToast(),e&&e()},5500)}closeToast(){this.isToastOpen=!1}};a.\u0275fac=function(t){return new(t||a)(S(me))},a.\u0275cmp=w({type:a,selectors:[["app-retrait-agent"]],features:[R([N])],decls:37,vars:15,consts:[[1,"ion-page"],["slot","start"],["defaultHref","/accueil"],[3,"submit","formGroup"],[1,"search-container"],["label","Non itilizate","label-placement","floating","placeholder","Antre non itilizate a","helperText","Antre yon non itilizate ki valid","errorText","Non itilizate a paka rete vid","required","","formControlName","username"],["class","result-container",4,"ngIf"],["label","Kantite Lajan (HTG)","label-placement","floating","placeholder","Antre kantite kob retre a","helperText","Antre on chif ki siperye a 0","required","","type","number","formControlName","montant",3,"errorText"],[1,"titre-montant"],[1,"last-ion-row"],["expand","block","type","submit","disabled","true"],["expand","block","type","submit"],["position","top",3,"color","isOpen","message","duration","icon"],[1,"result-container"],[1,"result"],[1,"m-item"],[1,"m-item",3,"click"]],template:function(t,e){t&1&&(n(0,"div",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",1),m(4,"ion-back-button",2),o(),n(5,"ion-title"),l(6,"Retre Kliyan"),o()()(),n(7,"ion-content")(8,"form",3),f("submit",function(){return e.onSubmit()}),n(9,"ion-grid")(10,"ion-row")(11,"ion-col")(12,"div",4),m(13,"ion-input",5),h(14,ge,6,2,"div",6),o()()(),n(15,"ion-row")(16,"ion-col"),m(17,"ion-input",7),o()(),n(18,"ion-row")(19,"ion-col")(20,"div",8),l(21,"Kantite lajan kap soti sou kont kliyan :"),o(),n(22,"b"),l(23),u(24,"customCurrency"),o()()(),n(25,"ion-row")(26,"ion-col")(27,"div",8),l(28,"Komisyon Ajan :"),o(),n(29,"b"),l(30),u(31,"customCurrency"),o()()(),n(32,"ion-row",9)(33,"ion-col"),h(34,ve,2,0,"ion-button",10)(35,Te,3,0,"ion-button",11),o()()()(),m(36,"ion-toast",12),o()()),t&2&&(s(8),p("formGroup",e.formGroup),s(6),p("ngIf",e.isFocus),s(3),p("errorText",e.montantErrorText),s(6),v(d(24,11,e.montantCalculer)),s(7),v(d(31,13,e.commissionAgent)),s(4),A(e.isLoading?34:35),s(2),p("color",e.colorToast)("isOpen",e.isToastOpen)("message",e.toastMessage)("duration",5e3)("icon",e.iconToast))},dependencies:[le,Z,J,H,q,L,z,D,K,$,Y,te,oe,ne,W,Q,ie,ae,X,ee,re,se,B,F,V,U,de],styles:["form[_ngcontent-%COMP%]{height:100%}ion-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.last-ion-row[_ngcontent-%COMP%]{margin-top:auto}.result-container[_ngcontent-%COMP%]{position:relative}.result[_ngcontent-%COMP%]{position:absolute;width:100%;max-height:300px;overflow-y:auto;background:#fff;z-index:999}.m-item[_ngcontent-%COMP%]{padding:15px 2px;transition:all .2s}.m-item[_ngcontent-%COMP%]:active{background:#adadad}.titre-montant[_ngcontent-%COMP%]{font-size:15px;color:#535353;margin-bottom:5px}"]});let r=a;return r})();export{Pe as RetraitAgentPage};
