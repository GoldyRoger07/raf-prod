import{a as Y}from"./chunk-SU4FJGPX.js";import{a as X}from"./chunk-EY2RO5PF.js";import{a as $}from"./chunk-DIA63YHE.js";import{a as W}from"./chunk-CO4MTAOY.js";import{a as H}from"./chunk-N23KSFRB.js";import{$ as T,Cb as K,D as f,E as v,Ea as B,Ib as N,K as r,Kb as U,L as _,M as k,Na as E,P as C,Pa as Q,S as P,T as g,V as y,Z as n,_ as s,a as w,ca as I,da as h,ea as u,ga as A,ha as O,hb as R,ia as M,ka as o,la as z,lb as D,ma as m,nb as V,rb as j,sb as L,tb as F,ub as G,vb as J,ya as q}from"./chunk-44MH6WD3.js";import"./chunk-ZTRS6MQZ.js";import"./chunk-7AA6B6AB.js";import"./chunk-WAVX4AJH.js";import"./chunk-G67DLYCP.js";import"./chunk-G3CV3VGG.js";import"./chunk-IEY6ZC2G.js";import"./chunk-MNDBORQJ.js";import"./chunk-7QVI4S4L.js";import"./chunk-4U6PRYVA.js";import"./chunk-6BZ4INXC.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-LNJ3S2LQ.js";var S=class{constructor(c=0,i="",t="no-image",e=new Y){this.id=c,this.value=i,this.imageUrl=t,this.sujet=e}};var x=class{constructor(c=0,i="",t=!1,e=new S){this.id=c,this.value=i,this.isGood=t,this.question=e}};var ee=["timer"];function te(a,c){if(a&1&&(n(0,"b"),o(1),s()),a&2){let i=u(2);r(),m("",i.bestPartie.score," Ks")}}function ie(a,c){if(a&1&&(n(0,"b"),o(1),s()),a&2){let i=u(2);r(),m("",i.quiz==null?null:i.quiz.bestScore," Ks")}}function ne(a,c){if(a&1){let i=I();n(0,"div",3)(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",4),T(4,"ion-back-button",5),s(),n(5,"ion-title"),o(6,"kwiz Matematik"),s()()(),n(7,"ion-content")(8,"ion-grid")(9,"ion-row")(10,"ion-col")(11,"div",6)(12,"span"),o(13,"Meye Sko "),C(14,te,2,1,"b")(15,ie,2,1,"b"),s(),n(16,"span"),o(17,"Sko "),n(18,"b"),o(19),s()()()()(),n(20,"ion-row",7)(21,"ion-col",8)(22,"div",9)(23,"app-timer",10,0),h("timerComplete",function(){f(i);let e=u();return v(e.onTimerFinished())}),s()()()(),n(25,"ion-row")(26,"ion-col")(27,"div",11)(28,"p"),o(29),s()()()(),n(30,"ion-row",12)(31,"ion-col")(32,"div",13)(33,"div",14),h("click",function(){f(i);let e=u();return v(e.onClickToAnswer(e.reponses[0].id,"A"))}),n(34,"div",15),o(35,"A:"),s(),o(36),s(),n(37,"div",14),h("click",function(){f(i);let e=u();return v(e.onClickToAnswer(e.reponses[1].id,"B"))}),n(38,"div",15),o(39,"B:"),s(),o(40),s(),n(41,"div",14),h("click",function(){f(i);let e=u();return v(e.onClickToAnswer(e.reponses[2].id,"C"))}),n(42,"div",15),o(43,"C:"),s(),o(44),s(),n(45,"div",14),h("click",function(){f(i);let e=u();return v(e.onClickToAnswer(e.reponses[3].id,"D"))}),n(46,"div",15),o(47,"D:"),s(),o(48),s()()()()()()()}if(a&2){let i=u();r(14),y(i.bestPartie?14:15),r(5),m("",i.score," Ks"),r(10),z(i.question.value),r(4),g("reponse-box "+i.reponseStatutA),r(3),m(" ",i.reponses[0].value," "),r(),g("reponse-box "+i.reponseStatutB),r(3),m(" ",i.reponses[1].value," "),r(),g("reponse-box "+i.reponseStatutC),r(3),m(" ",i.reponses[2].value," "),r(),g("reponse-box "+i.reponseStatutD),r(3),m(" ",i.reponses[3].value," ")}}var ge=(()=>{let c=class c{refreshComponent(){this.refresh=!1,setTimeout(()=>this.refresh=!0,10)}resetReponseStatuts(){setTimeout(()=>{this.reponseStatutA="",this.reponseStatutB="",this.reponseStatutC="",this.reponseStatutD=""},1e3)}constructor(t,e,p,b,Z){this.urlService=t,this.activatedRoute=e,this.webSocketService=p,this.router=b,this.quizService=Z,this.isAlertOpen=!1,this.timerLeft=0,this.score=0,this.quiz=null,this.bestPartie=null,this.question=new S,this.reponses=[new x,new x,new x,new x],this.reponseStatutA="",this.reponseStatutB="",this.reponseStatutC="",this.reponseStatutD="",this.reponseLetter="",this.message="",this.idQuiz=0,this.refresh=!0,this.subscription=new w,this.alertButtons=[{text:"Akey",role:"cancel",handler:()=>{this.router.navigate(["/accueil"])}},{text:"Jwe on lot pati",role:"confirm",handler:()=>{this.subscription.add(this.quizService.askForStartPartie(this.idQuiz.toString()).subscribe({next:()=>{this.score=0,this.webSocketService.firstQuestion(),this.timer.subscription=new w},error:d=>{this.message=d.error.message.contenu}}))}}],this.callbacks={onGetQuestion:d=>{let l=JSON.parse(d.body);l.timerPartie&&(this.timer.timerLeft=l.timerPartie,this.timer.startTimer()),console.log(l),this.resetReponseStatuts(),setTimeout(()=>{this.question=l.question,this.reponses=l.reponses},1700)},onEndPartie:d=>{let l=JSON.parse(d.body);this.message="Ou reponn "+l.partie.score+" kesyon",this.idQuiz=l.partie.quiz.id,l.canPlayAgain!=="oui"&&(this.alertButtons[1].text="Rechaje kont mwen",this.alertButtons[1].handler=()=>{this.router.navigate(["/transactions/depot"])}),this.isAlertOpen=!0},onUpdateScore:d=>{let l=d.body;this.score=l,console.log(`this.score = ${this.score}`)},onGetReponseStatut:d=>{let l=d.body;this.setStatutToReponseLetter(l)}}}initQuiz(t){this.subscription.add(this.quizService.getQuiz(t).subscribe({next:e=>{this.quiz=e}}))}initBestPartie(t){this.subscription.add(this.quizService.getBestPartieByQuiz(t).subscribe({next:e=>{this.bestPartie=e}}))}ngAfterViewInit(){let t=this.activatedRoute.snapshot.params.id;this.initBestPartie(t),this.initQuiz(t),this.webSocketService.connect(this.callbacks)}setOpen(t){this.isAlertOpen=t}onTimerFinished(){console.log(this.timerLeft),console.log("Le Timer est terminer")}setResult(t){console.log(`Dismissed with role: ${t.detail.role}`)}onClickToAnswer(t,e){let p={idQuestion:this.question.id,idReponse:t};this.reponseLetter=e,this.webSocketService.sendReponseToServer(p)}setStatutToReponseLetter(t){switch(t==="success"?this.playSound("good"):this.playSound("bad"),this.resetReponseStatuts(),this.reponseLetter){case"A":this.reponseStatutA=t;break;case"B":this.reponseStatutB=t;break;case"C":this.reponseStatutC=t;break;case"D":this.reponseStatutD=t;break;default:this.resetReponseStatuts()}}playSound(t){let e=t==="good"?"assets/music/goodAnswer.mp3":"assets/music/badAnswer.mp3";new Audio(e).play()}onClickTimer(){this.webSocketService.firstQuestion()}ngOnDestroy(){this.subscription.unsubscribe(),this.webSocketService.disconnect()}};c.\u0275fac=function(e){return new(e||c)(_(H),_(E),_(W),_(Q),_(X))},c.\u0275cmp=k({type:c,selectors:[["app-partie"]],viewQuery:function(e,p){if(e&1&&A(ee,5),e&2){let b;O(b=M())&&(p.timer=b.first)}},decls:2,vars:4,consts:[["timer",""],["class","ion-page",4,"ngIf"],["header","Pati a fini",3,"didDismiss","isOpen","message","buttons"],[1,"ion-page"],["slot","start"],["defaultHref","/accueil"],[1,"ion-row-score"],[1,"ion-justify-content-center"],["size","2"],[1,"my-timer"],[3,"timerComplete"],[1,"question-box"],[1,"last-ion-row"],[1,"reponses-box"],[3,"click"],[1,"reponse-letter"]],template:function(e,p){e&1&&(C(0,ne,49,15,"div",1),n(1,"ion-alert",2),h("didDismiss",function(){return p.setOpen(!1)}),s()),e&2&&(P("ngIf",p.refresh),r(),P("isOpen",p.isAlertOpen)("message",p.message)("buttons",p.alertButtons))},dependencies:[V,L,K,G,D,j,F,J,N,U,B,q,R,$],styles:["ion-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;padding-bottom:100px}.last-ion-row[_ngcontent-%COMP%]{margin-top:auto}.ion-row-score[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.ion-row-score[_ngcontent-%COMP%]   col[_ngcontent-%COMP%]{width:max-content}.reponses-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.reponse-box[_ngcontent-%COMP%]{border:1px solid #eee;border-radius:10px;padding:15px 10px;display:flex;gap:15px}.reponse-box.success[_ngcontent-%COMP%]{background:#b4ff6d}.reponse-box.error[_ngcontent-%COMP%]{background:#ff6d6d}.question-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:35dvh}.my-timer[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:50%;border:1px solid #eee;display:flex;align-items:center;justify-content:center}.reponse-letter[_ngcontent-%COMP%]{padding:0 5px;display:inline;color:var(--ion-color-primary);font-weight:700}"]});let a=c;return a})();export{ge as PartiePage};
