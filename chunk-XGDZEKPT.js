import{a as T}from"./chunk-CKSLSD4F.js";import{C as J,a as Z,h as H,j as W}from"./chunk-EX5FDRWG.js";import"./chunk-HB54646I.js";import{$b as R,Db as z,Eb as A,Fb as F,Gb as L,Hb as q,Ib as P,Pb as V,Ra as y,Tb as B,Ub as D,V as m,Vb as U,W as f,Wb as $,X as b,Xb as j,_ as E,a as v,ab as S,ba as u,ea as w,hb as n,ia as i,ib as x,ja as a,jb as C,ka as p,kb as k,mb as c,nb as N,oa as I,pb as G,qb as M,va as g,vb as O,yb as _}from"./chunk-IPMCES2K.js";import"./chunk-5TIO4NZJ.js";import"./chunk-KB6NU4VA.js";import"./chunk-KQGH3CXZ.js";import"./chunk-W6UBUTQL.js";import"./chunk-G3CV3VGG.js";import"./chunk-WSXCG4BJ.js";import"./chunk-453ZWRIO.js";import"./chunk-A7ODLDCL.js";import"./chunk-4U6PRYVA.js";import"./chunk-6BZ4INXC.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-6SXTDW4T.js";function K(l,s){l&1&&(i(0,"ion-button",9),p(1,"ion-spinner"),a())}function Q(l,s){l&1&&(i(0,"ion-button",10)(1,"ion-text"),g(2,"Modifye"),a()())}var le=(()=>{let s=class s{constructor(e,o){this.compteService=e,this.router=o,this.formGroup=new k({nom:new c("",[n.required,n.minLength(3),n.pattern("^[a-zA-Z\\s]+$")]),prenom:new c("",[n.required,n.minLength(3),n.pattern("^[a-zA-Z\\s]+$")]),telephone:new c("",[n.required,n.pattern("^[0-9]{8}$")]),username:new c("",[n.required,n.minLength(4),n.pattern("^[a-zA-Z0-9\\s]+$")])}),this.isLoading=!1,this.toastColor="",this.isToastOpen=!1,this.toastMessage="",this.toastIcon="",this.compte=new T,this.prenomErrorText="Non an paka rete vid",this.nomErrorText="Sinyati an paka rete vid",this.telephoneErrorText="Nimewo Telefon nan paka rete vid",this.usernameErrorText="Non itilizate a paka rete vid",this.subscription=new v,J({checkmarkSharp:H,closeSharp:W}),this.subscription.add(this.formGroup.valueChanges.subscribe(()=>{this.showErrorsWhenFormIsInvalid(this.formGroup.controls)}))}initCompte(){this.subscription.add(this.compteService.getCompteAuthenticated().subscribe({next:e=>{this.initFormGroup(e),this.compte=e},error:()=>{}}))}initFormGroup(e){this.formGroup.setValue({nom:e.nom,prenom:e.prenom,telephone:e.telephone,username:e.username})}showErrorsWhenFormIsInvalid(e){Object.keys(e).forEach(o=>{e[o].invalid&&(e[o].touched||e[o].dirty)&&(e[o].hasError("required")&&this.requiredErrorText(o),e.prenom.hasError("minlength")&&(this.prenomErrorText="Non an dwe gen pou pi piti 3 karakte"),e.prenom.hasError("pattern")&&(this.prenomErrorText="Non sa pa valid"),e.nom.hasError("minlength")&&(this.nomErrorText="Sinyati an dwe gen pou pi piti 3 karakte"),e.nom.hasError("pattern")&&(this.nomErrorText="Sinyati sa pa valid"),e.username.hasError("minlength")&&(this.usernameErrorText="Non itilizate an dwe gen pou pi piti 4 karakte"),e.username.hasError("pattern")&&(this.usernameErrorText="Non itilizate sa pa valid"),e.telephone.hasError("pattern")&&(this.telephoneErrorText="Nimewo telefon nan sipoze gen 8 chif"))})}requiredErrorText(e){switch(e){case"prenom":this.prenomErrorText="Non an paka rete vid";break;case"nom":this.nomErrorText="Sinyati an paka rete vid";break;case"telephone":this.telephoneErrorText="Nimewo telefon nan paka rete vid";break;case"username":this.usernameErrorText="Non itilizate an paka rete vid";break}}onSubmit(){var e,o,t;if(this.formGroup.markAllAsTouched(),!this.formGroup.invalid){this.isLoading=!0;let r=this.formGroup.value,d=new T;r.nom=(e=r.nom)==null?void 0:e.trim(),r.prenom=(o=r.prenom)==null?void 0:o.trim(),r.username=(t=r.username)==null?void 0:t.trim(),d.nom=r.nom,d.prenom=r.prenom,d.telephone=r.telephone,d.username=r.username,this.compteService.updateInfo(d).subscribe({next:h=>{this.isLoading=!1,this.showToast(h.message.contenu,h.message.type)},error:h=>{this.isLoading=!1;try{this.showToast(h.error.message.contenu,h.error.message.type,()=>{h.error.message.codeError===1&&(this.formGroup.reset(),this.router.navigate(["/login"]))})}catch{this.showToast("Verifye koneksyon entenet ou an","error")}}})}}showToast(e,o,t){o==="success"?(this.toastIcon="checkmark-sharp",this.toastColor="success"):(this.toastIcon="close-sharp",this.toastColor="danger"),this.toastMessage=e,this.isToastOpen=!0,setTimeout(()=>{this.closeToast(),t&&t()},3500)}closeToast(){this.isToastOpen=!1}ngOnInit(){this.initCompte(),localStorage.getItem("loginStatus")==="newGoogleUser"&&(this.showToast("Nou voye on modpass pou ou sou imel ou an","success"),localStorage.removeItem("loginStatus"))}ngOnDestroy(){this.subscription.unsubscribe()}};s.\u0275fac=function(o){return new(o||s)(f(Z),f(S))},s.\u0275cmp=b({type:s,selectors:[["app-update-infos"]],decls:27,vars:15,consts:[[1,"ion-page"],["slot","start"],["defaultHref","/accueil"],[3,"submit","formGroup"],["formControlName","prenom","label","Non","label-placement","floating","placeholder","Antre non ou","helperText","Sa ap pemet nou pi byen idantifye w",3,"errorText","value"],["formControlName","nom","label","Sinyati","label-placement","floating","placeholder","Antre sinyatiw ou","helperText","Sa ap pemet nou pi byen idantifye w",3,"errorText","value"],["formControlName","telephone","type","telephone","label","Telefon","label-placement","floating","placeholder","Antre telefon ou","helperText","Nimewo sa ap pemet ou fe tranzaksyon MonCash sou platfom lan",3,"errorText","value"],["formControlName","username","label","Non Itilizate","label-placement","floating","placeholder","Antre on non itilizate","helperText","Non sa ap pemet ou pi diskre sou platfom nan",3,"errorText","value"],[1,"last-ion-row"],["disabled","true","expand","block","type","submit"],["expand","block","type","submit"],["position","top",3,"color","isOpen","message","duration","icon"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",1),p(4,"ion-back-button",2),a(),i(5,"ion-title"),g(6,"Modifye Enfomasyon Pesonel"),a()()(),i(7,"ion-content")(8,"form",3),I("submit",function(){return t.onSubmit()}),i(9,"ion-grid")(10,"ion-row")(11,"ion-col"),p(12,"ion-input",4),a()(),i(13,"ion-row")(14,"ion-col"),p(15,"ion-input",5),a()(),i(16,"ion-row")(17,"ion-col"),p(18,"ion-input",6),a()(),i(19,"ion-row")(20,"ion-col"),p(21,"ion-input",7),a()(),i(22,"ion-row",8)(23,"ion-col"),E(24,K,2,0,"ion-button",9)(25,Q,3,0,"ion-button",10),a()()()(),p(26,"ion-toast",11),a()()),o&2&&(m(8),u("formGroup",t.formGroup),m(4),u("errorText",t.prenomErrorText)("value",t.compte.prenom),m(3),u("errorText",t.nomErrorText)("value",t.compte.nom),m(3),u("errorText",t.telephoneErrorText)("value",t.compte.telephone),m(3),u("errorText",t.usernameErrorText)("value",t.compte.username),m(3),w(t.isLoading?24:25),m(2),u("color",t.toastColor)("isOpen",t.isToastOpen)("message",t.toastMessage)("duration",3e3)("icon",t.toastIcon))},dependencies:[$,D,B,z,O,N,x,C,G,M,R,F,V,q,_,A,L,P,U,j,y],styles:["form[_ngcontent-%COMP%]{height:100%}ion-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.last-ion-row[_ngcontent-%COMP%]{margin-top:auto}"]});let l=s;return l})();export{le as UpdateInfosPage};
