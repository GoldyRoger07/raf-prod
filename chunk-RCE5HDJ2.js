import{a as de}from"./chunk-2QZJ7VVD.js";import{a as ue}from"./chunk-IB4EGLVS.js";import{C as ce,a as le,j as pe}from"./chunk-RCIVPRKJ.js";import"./chunk-N23KSFRB.js";import{$ as p,$a as b,Aa as N,Cb as ie,D as I,Da as V,E as A,Ea as B,Gb as ne,Hb as oe,Ib as re,Jb as se,K as a,Kb as ae,L as S,M as O,Ob as me,P as f,S as l,V as w,W as k,Wa as _,X as D,Xa as L,Y as G,Ya as z,Z as n,Za as j,_ as o,ab as q,ca as P,cb as K,da as u,db as R,ea as g,eb as $,g as C,ib as U,ka as m,la as v,lb as H,ma as E,nb as Z,o as T,oa as M,qb as W,ra as d,rb as J,s as x,sa as h,sb as Q,t as y,tb as X,ub as Y,vb as ee,ya as F,zb as te}from"./chunk-44MH6WD3.js";import"./chunk-ZTRS6MQZ.js";import"./chunk-7AA6B6AB.js";import"./chunk-WAVX4AJH.js";import"./chunk-G67DLYCP.js";import"./chunk-G3CV3VGG.js";import"./chunk-IEY6ZC2G.js";import"./chunk-MNDBORQJ.js";import"./chunk-7QVI4S4L.js";import"./chunk-4U6PRYVA.js";import"./chunk-6BZ4INXC.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import"./chunk-LNJ3S2LQ.js";function fe(r,s){if(r&1){let c=P();n(0,"div",17),u("click",function(){let i=I(c).$implicit,e=g(2);return A(e.onClickRow(i))}),m(1),o()}if(r&2){let c=s.$implicit;a(),E(" ",c," ")}}function ge(r,s){if(r&1&&(n(0,"div",14)(1,"div",15)(2,"ion-list"),D(3,fe,2,1,"div",16,k),d(5,"async"),o()()()),r&2){let c=g();a(3),G(h(5,0,c.usernames$))}}function ve(r,s){r&1&&(n(0,"ion-button",10),p(1,"ion-spinner"),o())}function _e(r,s){r&1&&(n(0,"ion-button",11)(1,"ion-text"),m(2,"Valide"),o()())}var Ge=(()=>{let s=class s{constructor(t){this.compteService=t,this.formGroup=new j({username:new b("",[_.required]),montant:new b("",[_.required,de])}),this.montantErrorText="Kantite lajan an paka rete vid",this.isFocus=!1,this.isLoading=!1,this.isAlertOpen=!1,this.isToastOpen=!1,this.message="",this.toastMessage="",this.alertButtons=[{text:"Ok",role:"cancel",handler:()=>{this.setOpen(!1)}}],this.usernames$=this.getUsernames(),this.commissionDepot=1,this.montantCalculer=0,this.commissionAgent=0,ce({closeSharp:pe}),this.formGroup.controls.username.valueChanges.subscribe(()=>{this.isFocus||(this.isFocus=!0)}),this.formGroup.controls.montant.valueChanges.subscribe(i=>{let e=parseInt(i);e>=0?(this.montantCalculer=e*this.commissionDepot,this.commissionAgent=e-this.montantCalculer):(this.montantCalculer=0,this.commissionAgent=0),this.formGroup.controls.montant.hasError("greaterThanZero")&&(this.montantErrorText="Chif sa pa valid")})}ngOnInit(){this.compteService.getAgentCommissionDepot().subscribe({next:t=>{this.commissionDepot=t}})}onSubmit(){if(this.formGroup.markAllAsTouched(),!this.formGroup.invalid){this.isLoading=!0;let t=this.formGroup.value;this.compteService.depotAgent(t).subscribe({next:i=>{this.isLoading=!1,this.formGroup.reset(),this.message=i.descriptionAgent,this.setOpen(!0)},error:i=>{this.isLoading=!1;try{this.showToast(i.error.message.contenu,i.error.message.type)}catch{this.showToast("Verifye koneksyon entenet ou an","error")}}})}}getUsernames(){let t=this.formGroup.controls.username.valueChanges.pipe(x(""),T(150));return C([t]).pipe(y(([i])=>this.compteService.getAllUsernames(i)))}onClickRow(t){this.formGroup.setValue({username:t,montant:this.formGroup.value.montant}),this.isFocus=!1}setOpen(t){this.isAlertOpen=t}showToast(t,i,e){this.toastMessage=t,this.isToastOpen=!0,setTimeout(()=>{this.closeToast(),e&&e()},3500)}closeToast(){this.isToastOpen=!1}};s.\u0275fac=function(i){return new(i||s)(S(le))},s.\u0275cmp=O({type:s,selectors:[["app-depot-agent"]],features:[M([V])],decls:38,vars:16,consts:[[1,"ion-page"],["slot","start"],["defaultHref","/accueil"],[3,"submit","formGroup"],[1,"search-container"],["label","Non itilizate","label-placement","floating","placeholder","Antre non itilizate a","helperText","Antre yon non itilizate ki valid","errorText","Non itilizate a paka rete vid","required","","formControlName","username"],["class","result-container",4,"ngIf"],["label","Kantite Lajan (HTG)","label-placement","floating","placeholder","Antre kantite kob depo a","helperText","Antre on chif ki siperye a 0","required","","type","number","formControlName","montant",3,"errorText"],[1,"titre-montant"],[1,"last-ion-row"],["expand","block","type","submit","disabled","true"],["expand","block","type","submit"],["color","danger","position","top","icon","close-sharp",3,"isOpen","message","duration"],["header","Notifikasyon",3,"didDismiss","isOpen","message","buttons"],[1,"result-container"],[1,"result"],[1,"m-item"],[1,"m-item",3,"click"]],template:function(i,e){i&1&&(n(0,"div",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",1),p(4,"ion-back-button",2),o(),n(5,"ion-title"),m(6,"Depo Kliyan"),o()()(),n(7,"ion-content")(8,"form",3),u("submit",function(){return e.onSubmit()}),n(9,"ion-grid")(10,"ion-row")(11,"ion-col")(12,"div",4),p(13,"ion-input",5),f(14,ge,6,2,"div",6),o()()(),n(15,"ion-row")(16,"ion-col"),p(17,"ion-input",7),o()(),n(18,"ion-row")(19,"ion-col")(20,"div",8),m(21,"Kantite lajan kliyan ap resevwa :"),o(),n(22,"b"),m(23),d(24,"customCurrency"),o()()(),n(25,"ion-row")(26,"ion-col")(27,"div",8),m(28,"Komisyon Ajan :"),o(),n(29,"b"),m(30),d(31,"customCurrency"),o()()(),n(32,"ion-row",9)(33,"ion-col"),f(34,ve,2,0,"ion-button",10)(35,_e,3,0,"ion-button",11),o()()()(),p(36,"ion-toast",12),n(37,"ion-alert",13),u("didDismiss",function(){return e.setOpen(!1)}),o()()()),i&2&&(a(8),l("formGroup",e.formGroup),a(6),l("ngIf",e.isFocus),a(3),l("errorText",e.montantErrorText),a(6),v(h(24,12,e.montantCalculer)),a(7),v(h(31,14,e.commissionAgent)),a(4),w(e.isLoading?34:35),a(2),l("isOpen",e.isToastOpen)("message",e.toastMessage)("duration",3e3),a(),l("isOpen",e.isAlertOpen)("message",e.message)("buttons",e.alertButtons))},dependencies:[Z,te,me,U,q,L,z,$,K,R,se,ne,oe,W,Q,ie,Y,H,J,X,ee,re,ae,B,F,N,ue],styles:["form[_ngcontent-%COMP%]{height:100%}ion-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.last-ion-row[_ngcontent-%COMP%]{margin-top:auto}.result-container[_ngcontent-%COMP%]{position:relative}.result[_ngcontent-%COMP%]{position:absolute;width:100%;max-height:300px;overflow-y:auto;background:#fff;z-index:999}.m-item[_ngcontent-%COMP%]{padding:15px 2px;transition:all .2s}.m-item[_ngcontent-%COMP%]:active{background:#adadad}.titre-montant[_ngcontent-%COMP%]{font-size:15px;color:#535353;margin-bottom:5px}"]});let r=s;return r})();export{Ge as DepotAgentPage};
